version: 2
jobs:
  build:
    machine: true
    working_directory: ~/fdk-ruby
    steps:
      - checkout
      - run:
          name: Set ruby version to 2.7
          command: |
            rvm install 2.7.3
            echo . $(rvm 2.7.3 do rvm env --path) >> $BASH_ENV
      - run:
          name: version
          command: ruby -v
      - run:
          name: build
          command: gem build hellohello.gemspec
      - run:
          name: build
          command: gem install --development *.gem

      - run:
          name: setup build gem
          command: ./setup_gems.sh
      - run:
          name: push
          command: ./release.sh